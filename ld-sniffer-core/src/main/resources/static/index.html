<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>LD Quality Assessment</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="//cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.9/css/dataTables.bootstrap.min.css" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>

    <![endif]-->
</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Linked Data Quality Model - Quality Assessment</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <form class="navbar-form navbar-right">
            </form>
        </div><!--/.navbar-collapse -->
    </div>
</nav>

<!-- Main jumbotron for a primary marketing message or call to action -->
<div class="jumbotron">
    <div class="container">
        <h3>Assess the quality of your Linked Data resources </h3>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="panel panel-default">
            <div class="panel-heading">
                Enter the URI of the Linked Data Resource:
            </div>
            <div class="panel-body">
                <form class="form-inline" id="formWord" action="/assess" method="GET" accept-charset="UTF-8">
                    <div class="form-group">
                        <label for="uri">LD Resource URI&nbsp;&nbsp;</label>
                        <input type="text" size="30" class="form-control" id="uri" name="uri" placeholder="http://es.dbpedia.org/resource/Madrid">
                    </div>
                    <button type="submit" class="btn btn-default">Analyze</button>
                    <div id="wordResult">

                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<script type="text/javascript" src="//cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>

<script>

    var waitingDialog = waitingDialog || (function ($) {
                'use strict';

                // Creating modal dialog's DOM
                var $dialog = $(
                        '<div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;">' +
                        '<div class="modal-dialog modal-m">' +
                        '<div class="modal-content">' +
                        '<div class="modal-header"><h3 style="margin:0;"></h3></div>' +
                        '<div class="modal-body">' +
                        '<div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div>' +
                        '</div>' +
                        '</div></div></div>');

                return {
                    /**
                     * Opens our dialog
                     * @param message Custom message
                     * @param options Custom options:
                     * 				  options.dialogSize - bootstrap postfix for dialog size, e.g. "sm", "m";
                     * 				  options.progressType - bootstrap postfix for progress bar type, e.g. "success", "warning".
                     */
                    show: function (message, options) {
                        // Assigning defaults
                        if (typeof options === 'undefined') {
                            options = {};
                        }
                        if (typeof message === 'undefined') {
                            message = 'Loading';
                        }
                        var settings = $.extend({
                            dialogSize: 'm',
                            progressType: '',
                            onHide: null // This callback runs after the dialog was hidden
                        }, options);

                        // Configuring dialog
                        $dialog.find('.modal-dialog').attr('class', 'modal-dialog').addClass('modal-' + settings.dialogSize);
                        $dialog.find('.progress-bar').attr('class', 'progress-bar');
                        if (settings.progressType) {
                            $dialog.find('.progress-bar').addClass('progress-bar-' + settings.progressType);
                        }
                        $dialog.find('h3').text(message);
                        // Adding callbacks
                        if (typeof settings.onHide === 'function') {
                            $dialog.off('hidden.bs.modal').on('hidden.bs.modal', function (e) {
                                settings.onHide.call($dialog);
                            });
                        }
                        // Opening dialog
                        $dialog.modal();
                    },
                    /**
                     * Closes dialog
                     */
                    hide: function () {
                        $dialog.modal('hide');
                    }
                };

            })(jQuery);

     $(document).ready(function() {

     // process the form
     $('#formWord').submit(function(event) {

     // get the form data
     var uri = $('input[name=uri]').val();

     // process the form
     $.ajax({
     type        : 'GET',
     url         : 'assess?uri=' + uri,
     dataType    : 'json',
     encode      : true,
     beforeSend: function(){
         waitingDialog.show("This may take a while depending on the number of URIs to check ...");
         $('#wordResult').empty();
     }
     }).done(function(data) {

     waitingDialog.hide();

     var indicatorsTable = createIndicatorsTable(data);
     $('#wordResult').append(indicatorsTable);

     var errSubjectsTable = createErrSubjectsTable(data.errSubjects);
     $('#wordResult').append(errSubjectsTable);

     $('#subjectErrTable').dataTable( {
         "info":     false,
         'bFilter': false
     } );


//     if (category === 'noun') {
//     var table = createNounTable (word);
//     $('#wordResult').append(table);
//     } else if (category === 'verb') {
//     var table = createVerbTable (word);
//     $('#wordResult').append(table);
//     } else if (category === "adverb" ){
//     var table = createAdverbTable(word);
//     $('#wordResult').append(table);
//     } else if (category === "pronoun" ){
//     var table = createPronounTable(word);
//     $('#wordResult').append(table);
//     } else if (category === "preposition"){
//     var table = createPrepositionTable(word);
//     $('#wordResult').append(table);
//     } else if (category === "adjective"){
//     var table = createAdjectiveTable(word);
//     $('#wordResult').append(table);
//     } else if (category === "datetime"){
//     var table = createDateTimeTable(word);
//     $('#wordResult').append(table);
//     } else if (category === "interjection"){
//     var table = createInterjectionTable(word);
//     $('#wordResult').append(table);
//     } else if (category === "determinant"){
//     var table = createDeterminantTable(word);
//     $('#wordResult').append(table);
//     }


     }).fail(function (jqXHr, textStatus, errorThrown) {

     $('#wordResult').empty();
     $('#wordResult').append('<div class="alert alert-danger">The word you searched was not found in the indexed list</div>');

     });

     // stop the form from submitting the normal way and refreshing the page
     event.preventDefault();
     });

     });

     function createIndicatorsTable (data) {
     var tb = '<br/><table class="table table-striped table-bordered table-condensed">';
     tb +=  '<thead><tr><th colspan="2"> Indicators </th></tr></thead>';
     tb += '<tr><th><a href="http://linkeddata.es/resource/ldqm/QualityIndicator/Averagesubjectdereferenceability">Average Subject Dereferenceability</a></th><th>' + data.avgSubjectDereferenceablility + '</th></tr>';
     tb += '<tr><th><a href="">Number of subjects</a> </th><th>' + data.numberOfSubjects + '</th></tr>';
     tb += '<tr><th><a href="">Number of dereferenceable subjects </a> </th><th>' + data.numberOfDereferenceableSubjects + '</th></tr>';
     tb += '</table>';
     return tb;
     }

    function createErrSubjectsTable(errSubjects) {

        var tb = '<br/><table id="subjectErrTable" class="table table-striped table-bordered table-condensed">';
        tb +=  '<thead><tr><th colspan="3"> Undereferenceable Subjects </th></tr><tr><th>Subject URI</th><th>Status Code</th><th>Reason Phrase</th></tr></thead>';
        for (i = 0; i < errSubjects.length; i++) {
            var errSubject = errSubjects[i];
            tb += '<tr><th>'+ errSubject.uri +'</th><th>' + errSubject.statusCode + '</th><th>' + errSubject.reason + '</th></tr>';

        }
        tb += '</table>';
        return tb;
    }


</script>

</body>
</html>